//
//  XKValidationAndAddScoreTools.m
//  eHealthCare
//
//  Created by mac on 2017/11/2.
//  Copyright Â© 2017å¹´ mac. All rights reserved.
//

#import "XKValidationAndAddScoreTools.h"
#import "XKHealthIntegralTaskSuccessView.h"
#import "XKCompleteTaskModel.h"

@interface XKValidationAndAddScoreTools()

@property (nonatomic,strong) XKCompleteTaskModel *data;

@end

@implementation XKValidationAndAddScoreTools
//goTask?TaskType=1&TypeID=1ï¼ˆTaskType 1ã€æ¯æ—¥ä»»åŠ¡  2ã€ç¦åˆ©ä»»åŠ¡å³å®Œå–„æ¡£æ¡ˆï¼ŒTypeID ä»»åŠ¡åˆ†ç±»   å¦‚ 1ã€ç­¾åˆ°ç­‰ï¼‰
-(XKCompleteTaskModel *)validationAndAddScore:(NSDictionary *)validationDict withAdd:(NSDictionary *)addScoreDcit{
    self.data = nil;
    NSLog(@"é…ç½®çš„å‚æ•°%@--%@",validationDict,addScoreDcit);
    [ProtosomaticHttpTool protosomaticPostWithURLString:@"943" parameters:validationDict success:^(id json) {
        NSLog(@"943éªŒè¯å½“å‰ä»»åŠ¡æ˜¯å¦å®Œæˆ--:%@",json);
        if ([json[@"Basis"][@"Msg"] isEqualToString:@"æ“ä½œæˆåŠŸ"]) {
            
            if ([json[@"Result"][@"Iscomplete"] integerValue] == 0 && [json[@"Result"][@"IsExistsTask"] integerValue] == 1) {//æœªå®Œæˆ
                [ProtosomaticHttpTool protosomaticPostWithURLString:@"940" parameters:addScoreDcit success:^(id json) {
                    NSLog(@"940å®Œæˆä»»åŠ¡åŠ åˆ†--:%@",json);
                    if ([json[@"Basis"][@"Msg"] isEqualToString:@"æ“ä½œæˆåŠŸ"]) {
                        [[XKLoadingView shareLoadingView] hideLoding];
                        
                        self.data = [XKCompleteTaskModel objectWithKeyValues:json[@"Result"]];
                        
                        XKHealthIntegralTaskSuccessView *taskV = [[[NSBundle mainBundle] loadNibNamed:@"XKHealthIntegralTaskSuccessView" owner:self options:nil] firstObject];
                        if ([validationDict[@"TaskType"] integerValue] == 1) {//æ¯æ—¥ä»»åŠ¡
//                            taskV.kangImg.hidden = YES;
                           // taskV.tatolKValueLab.hidden = NO;
                           // taskV.kmarkLab.hidden = NO;
                        }else{//ç¦åˆ©ä»»åŠ¡
//                            taskV.kangImg.hidden = NO;
                        //    taskV.tatolKValueLab.hidden = YES;
                          //  taskV.kmarkLab.hidden = YES;
                        }
                        taskV.frame = [UIScreen mainScreen].applicationFrame;
                        [[UIApplication sharedApplication].delegate.window addSubview:taskV];
                        taskV.completeModel = self.data;
                        NSLog(@"å®Œæˆä»»åŠ¡åŠ åˆ†æˆåŠŸğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†");
                    }else{
                        NSLog(@"ä»»åŠ¡å¤±è´¥åŠ åˆ†å¤±è´¥");
                        ShowErrorStatus(@"åŠ åˆ†å¤±è´¥");
                    }
                } failure:^(id error) {
                    NSLog(@"ä»»åŠ¡å¤±è´¥åŠ åˆ†å¤±è´¥");
                    ShowErrorStatus(@"ä»»åŠ¡å¤±è´¥");
                }];
            }
            NSLog(@"ç­¾åˆ°æˆåŠŸğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†ğŸ˜†");
        }else{
            NSLog(@"éªŒè¯å½“å‰ä»»åŠ¡æ˜¯å¦å®Œæˆå¤±è´¥");
            ShowErrorStatus(@"ä»»åŠ¡å¤±è´¥");
        }
    } failure:^(id error) {
        NSLog(@"éªŒè¯å½“å‰ä»»åŠ¡æ˜¯å¦å®Œæˆå¤±è´¥");
         ShowErrorStatus(@"ä»»åŠ¡å¤±è´¥");
    }];
    
    return self.data;
}

@end

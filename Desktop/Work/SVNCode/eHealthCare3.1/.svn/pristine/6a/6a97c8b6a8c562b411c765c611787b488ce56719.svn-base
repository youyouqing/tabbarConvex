//
//  PersonalArcHeadView.m
//  eHealthCare
//
//  Created by xiekang on 16/8/1.
//  Copyright © 2016年 mac. All rights reserved.
//

#import "PersonalArcHeadView.h"

@interface PersonalArcHeadView()
@property (weak, nonatomic) IBOutlet UIImageView *iconImgView;
@property (weak, nonatomic) IBOutlet UILabel *nameLal;
@property (weak, nonatomic) IBOutlet UILabel *ageLal;
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *trendBtnHeightCon;

@property (weak, nonatomic) IBOutlet NSLayoutConstraint *trendBtnWidthCon;

@end
@implementation PersonalArcHeadView
-(void)awakeFromNib
{
    [super awakeFromNib];
    self.iconImgView.contentMode  = UIViewContentModeScaleAspectFill;
    for (int i = 0; i<4; i++) {
        UIButton *btn = (UIButton *)[self viewWithTag:90+i];
        if (i == 0) {
            [btn setTitleColor:NAVICOLOR forState:UIControlStateNormal];
        }else{
            [btn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
        }
        
        //字体适配
        if (IS_IPHONE5) {
            btn.titleLabel.font = [UIFont systemFontOfSize:16];
        }else if (IS_IPHONE6) {
            btn.titleLabel.font = [UIFont systemFontOfSize:17];
        }else{
            btn.titleLabel.font = [UIFont systemFontOfSize:18];
        }
        
    }
 
    
    UIBezierPath *maskPath1 = [UIBezierPath bezierPathWithRoundedRect:CGRectMake(0, 0, self.trendBtnWidthCon.constant, self.trendBtnHeightCon.constant) byRoundingCorners:UIRectCornerTopLeft|UIRectCornerBottomLeft cornerRadii:CGSizeMake(15, 15)];
    CAShapeLayer *maskLayer1 = [[CAShapeLayer alloc] init];
    maskLayer1.frame = self.trendBtn.bounds;
    maskLayer1.path = maskPath1.CGPath;
    self.trendBtn.layer.mask = maskLayer1;

}
- (IBAction)clickFourBtn:(id)sender {
    UIButton *button = (UIButton *)sender;//这里使用tag,90~93
    for (int i = 0; i<=4; i++) {
        UIButton *btn = (UIButton *)[self viewWithTag:90+i];
        if (i + 90 == button.tag) {
            [btn setTitleColor:NAVICOLOR forState:UIControlStateNormal];
        }else{
            [btn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
        }
    }
    
    
    if ([self.delegate respondsToSelector:@selector(clickHeadBtn:)]) {
        [self.delegate clickHeadBtn:button.titleLabel.text];
    }
    
}

-(void)setModel:(PersonalArcModel *)model
{
    [_iconImgView sd_setImageWithURL:[NSURL URLWithString:model.HeadImg] placeholderImage:[UIImage imageNamed:@"defaultHead"]];
    
    if (((NSString *)model.FullName).length ==0) {
        _nameLal.text = @"";
    }else{
        NSString *str = [NSString stringWithFormat:@"%@  %@",model.FullName,model.Sex];
        NSRange range = [str rangeOfString:model.FullName];
        NSMutableAttributedString *attr = [[NSMutableAttributedString alloc]initWithString:str];
        [attr addAttribute:NSFontAttributeName value:[UIFont boldSystemFontOfSize:19] range:range];
        _nameLal.attributedText = attr;
    }
    
    NSLog(@"Birthday:%@ ,%li",model.Birthday,[(NSString *)model.Birthday integerValue ]);
    if ([NSString stringWithFormat:@"%@",model.Birthday].length == 0 || [[NSString stringWithFormat:@"%@",model.Birthday] integerValue ] <= 0) {
        if (_nameLal.text.length == 0) {
           _ageLal.text = @"暂只对检测用户开放";
            if (IS_IPHONE5) {
                _ageLal.font = [UIFont systemFontOfSize:14];
            }else{
                _ageLal.font = [UIFont systemFontOfSize:16];
            }
        }else{
           _ageLal.text = @"";//**有姓名的情况下，年龄无 如何显示
        }
    }else{
        //年龄计算
        Dateformat *dateFor = [[Dateformat alloc]init];
        NSString *birthYear  = [dateFor DateFormatWithDate:[NSString stringWithFormat:@"%@",model.Birthday] withFormat:@"YYYY"];
        NSDictionary *timeDic = [dateFor getDateTime];
        NSInteger age = [[timeDic[@"sumtime"] substringWithRange:NSMakeRange(0, 4)] integerValue] - [birthYear integerValue];
        _ageLal.text = [NSString stringWithFormat:@"%li 岁", age];
    }
}


/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect {
    // Drawing code
}
*/

@end

//
//  GuideView.m
//  eHealthCare
//
//  Created by John shi on 2018/7/5.
//  Copyright © 2018年 Jon Shi. All rights reserved.
//

#import "GuideView.h"

@interface GuideView ()

@property (nonatomic, strong) UIScrollView *guideScrollView;//引导页scrollview

@property (nonatomic, strong) NSArray *guideImageArray;//引导页
@property (nonatomic, strong) NSMutableArray *btnArray;//装所有计划的额按钮

@property (nonatomic, strong) NSArray *planArray;//选折有几项数据计划
@end

@implementation GuideView

- (instancetype)initWithFrame:(CGRect)frame
{
    if(self = [super initWithFrame:frame])
    {
        self.backgroundColor = [UIColor clearColor];
        [self setupSubviews];
    }
    return self;
}

// 添加子控件
- (void)setupSubviews
{
     [self setGuideImageArray:nil];
    
    _guideScrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(0, 0, KScreenWidth, KScreenHeight)];
    _guideScrollView.backgroundColor =[UIColor clearColor];
    _guideScrollView.bounces = NO;
    _guideScrollView.showsHorizontalScrollIndicator = NO;
    _guideScrollView.showsVerticalScrollIndicator = NO;
    _guideScrollView.delegate = self;
    _guideScrollView.pagingEnabled = YES;
    [self addSubview:_guideScrollView];
    _guideScrollView.contentSize = CGSizeMake(KScreenWidth * self.guideImageArray.count, KScreenHeight);
    
    
    
    UIButton *skipbutton = [UIButton buttonWithType:UIButtonTypeCustom];
    skipbutton.titleLabel.font = [UIFont systemFontOfSize:15.0];
    [skipbutton setTitle:@"跳过" forState:UIControlStateNormal];
    [skipbutton setTitleColor:[UIColor getColor:@"B3BBC4"] forState:UIControlStateNormal];
    [skipbutton addTarget:self action:@selector(hiddenGuidePage:) forControlEvents:UIControlEventTouchUpInside];
    skipbutton.layer.cornerRadius = KHeight(45)/2.0;
    skipbutton.frame = CGRectMake(_guideScrollView.frame.size.width - KWidth(106),  KHeight(15), KWidth(106), KHeight(45));
    [self addSubview:skipbutton];
    
    for (int i = 1; i < self.guideImageArray.count + 1; i++) {

        
        if (i == self.guideImageArray.count )
        {
            
            UILabel *nameLab = [[UILabel alloc]init];
            nameLab.text = @"感谢您，已对您有初步了解";
            nameLab.textColor = [UIColor getColor:@"2C4667"];
            nameLab.font = (Kfont(20));
            nameLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1),  KHeight(101), KScreenWidth, KHeight(20));
            nameLab.textAlignment = NSTextAlignmentCenter;
            [_guideScrollView addSubview:nameLab];
            
            
            UILabel *contentLab = [[UILabel alloc]init];
            contentLab.text = @"我们为您定制以下健康计划，请选择最想加入的计划";
            contentLab.textColor = [UIColor getColor:@"2C4667"];
            contentLab.font = Kfont(13);
            contentLab.textAlignment = NSTextAlignmentCenter;
            contentLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1), CGRectGetMaxY(nameLab.frame)+CGRectGetHeight(nameLab.frame)+KHeight(15),KScreenWidth, KHeight(20));
            [_guideScrollView addSubview:contentLab];
            
            
            self.btnArray = [[NSMutableArray alloc]init];
          
            for (int j = 0; j<4; j++) {
                
                UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
                button.tag = j+1234;
                button.titleLabel.font = [UIFont systemFontOfSize:13.0];
                [button setTitle:self.planArray[j] forState:UIControlStateNormal];
                 [button setTitleColor:[UIColor getColor:@"2C4667"]  forState:UIControlStateNormal];
                 [button setTitleColor:kMainColor  forState:UIControlStateSelected];
                [button setImage:[UIImage imageNamed:@""] forState:UIControlStateNormal];
                [button setImage:[UIImage imageNamed:@"iv_question_select"] forState:UIControlStateSelected];
                button.imageEdgeInsets = UIEdgeInsetsMake(0, -KWidth(40), 0, 0);
                [button addTarget:self action:@selector(selectBtn:) forControlEvents:UIControlEventTouchUpInside];
                button.layer.cornerRadius = KHeight(45)/2.0;
                button.layer.borderColor = [UIColor getColor:@"2C4667"].CGColor;
                button.layer.borderWidth = .5f;
                button.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+(KScreenWidth / 2 - KWidth(99)), CGRectGetMaxY(contentLab.frame)+CGRectGetHeight(contentLab.frame)+ KHeight(73)+j*(KHeight(45)+KHeight(10)), KWidth(199), KHeight(45));
                [_guideScrollView addSubview:button];
                
                [self.btnArray addObject:button];
            }
            
            
            
            UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
            [button setBackgroundColor:kMainColor];
            button.titleLabel.font = [UIFont systemFontOfSize:13.0];
            [button setTitle:@"开始我的健康之旅" forState:UIControlStateNormal];
            [button addTarget:self action:@selector(hiddenGuidePage:) forControlEvents:UIControlEventTouchUpInside];
            
            button.layer.cornerRadius = KHeight(45)/2.0;
            
            button.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+(KScreenWidth / 2 - KWidth(99)), KScreenHeight - KHeight(103), KWidth(199), KHeight(45));
            [_guideScrollView addSubview:button];
            
            
            
            
        }
        if (i == 1) {
            
            UIImageView *guidePageView = [[UIImageView alloc]initWithFrame:CGRectMake((KScreenWidth-KWidth(303))/2.0,KHeight(71) , KWidth(303), KHeight(81))];
            guidePageView.image = [UIImage imageNamed:self.guideImageArray[i - 1]];
            [_guideScrollView addSubview:guidePageView];
            
            
            UILabel *contentLab = [[UILabel alloc]init];
            contentLab.text = @"您的性别是？";
            contentLab.textColor = [UIColor getColor:@"2C4667"];
            contentLab.font = Kfont(20);
            contentLab.textAlignment = NSTextAlignmentCenter;
            contentLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1),CGRectGetHeight(guidePageView.frame)+CGRectGetMaxY(guidePageView.frame)+KHeight(83), KScreenWidth, KHeight(20));
            [_guideScrollView addSubview:contentLab];
            
            
            
            UIButton *yesbutton = [UIButton buttonWithType:UIButtonTypeCustom];
            yesbutton.titleLabel.font = [UIFont systemFontOfSize:13.0];
            [yesbutton setTitle:@"是" forState:UIControlStateNormal];
            [yesbutton addTarget:self action:@selector(yesbuttonSelect:) forControlEvents:UIControlEventTouchUpInside];
             [yesbutton setImage:[UIImage imageNamed:@"iv_question_man"] forState:UIControlStateNormal];
            yesbutton.layer.cornerRadius = KHeight(45)/2.0;
            yesbutton.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+ KWidth(49), CGRectGetHeight(contentLab.frame)+CGRectGetMaxY(contentLab.frame)+KHeight(41), KWidth(115), KHeight(115));
            [_guideScrollView addSubview:yesbutton];
            
            
            UIButton *NObutton = [UIButton buttonWithType:UIButtonTypeCustom];
            [NObutton setImage:[UIImage imageNamed:@"iv_question_female"] forState:UIControlStateNormal];

            NObutton.titleLabel.font = [UIFont systemFontOfSize:13.0];
            [NObutton setTitle:@"否" forState:UIControlStateNormal];
            [NObutton addTarget:self action:@selector(yesbuttonSelect:) forControlEvents:UIControlEventTouchUpInside];
            NObutton.layer.cornerRadius = KHeight(45)/2.0;
            
            NObutton.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+KScreenWidth  - KWidth(115)-KWidth(49), CGRectGetHeight(contentLab.frame)+CGRectGetMaxY(contentLab.frame)+KHeight(41), KWidth(115), KHeight(115));
            [_guideScrollView addSubview:NObutton];
            
            
            UILabel *manLab = [[UILabel alloc]init];
            manLab.text = @"男";
            manLab.textColor = [UIColor getColor:@"2C4667"];
            manLab.font = Kfont(20);
            manLab.textAlignment = NSTextAlignmentCenter;
            manLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+ KWidth(49),CGRectGetHeight(yesbutton.frame)+CGRectGetHeight(contentLab.frame)+CGRectGetMaxY(contentLab.frame)+KHeight(41)+KHeight(10), KWidth(106), KHeight(20));
            [_guideScrollView addSubview:manLab];
            
            
            UILabel *womanLab = [[UILabel alloc]init];
            womanLab.text = @"女";
            womanLab.textColor = [UIColor getColor:@"2C4667"];
            womanLab.font = Kfont(20);
            womanLab.textAlignment = NSTextAlignmentCenter;
            womanLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+KScreenWidth  - KWidth(106)-KWidth(49),CGRectGetHeight(yesbutton.frame)+CGRectGetHeight(contentLab.frame)+CGRectGetMaxY(contentLab.frame)+KHeight(41)+KHeight(10), KWidth(106), KHeight(20));
            [_guideScrollView addSubview:womanLab];
        }
        
        if (i == 2||i == 3)
        {
            UILabel *nameLab = [[UILabel alloc]init];
            nameLab.text = @"您的出生日期是？";
            nameLab.textColor = [UIColor getColor:@"2C4667"];
            nameLab.font = (Kfont(20));
            nameLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1),  KHeight(101), KScreenWidth, KHeight(20));
            nameLab.textAlignment = NSTextAlignmentCenter;
            [_guideScrollView addSubview:nameLab];
            
            
            UILabel *contentLab = [[UILabel alloc]init];
            contentLab.text = @"1990年1月1日";
            contentLab.textColor = kMainColor;
            contentLab.font = Kfont(17);
            contentLab.textAlignment = NSTextAlignmentCenter;
            contentLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1), CGRectGetMaxY(nameLab.frame)+CGRectGetHeight(nameLab.frame)+KHeight(41),KScreenWidth, KHeight(20));
            [_guideScrollView addSubview:contentLab];
            
            
            UIDatePicker *datepicker = [[UIDatePicker alloc]initWithFrame:CGRectMake(_guideScrollView.frame.size.width * (i - 1), (KScreenHeight-316)/2.0+KHeight(40), KScreenWidth, 316)];
            
            [_guideScrollView addSubview:datepicker];
            
            
            UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
            [button setBackgroundColor:kMainColor];
            button.titleLabel.font = [UIFont systemFontOfSize:13.0];
            [button setTitle:@"继续" forState:UIControlStateNormal];
            [button addTarget:self action:@selector(yesOrNO:) forControlEvents:UIControlEventTouchUpInside];
            _guideScrollView.userInteractionEnabled=YES;
            button.layer.cornerRadius = KHeight(45)/2.0;
            
            button.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+(KScreenWidth / 2 - KWidth(53)), KScreenHeight - KHeight(103), KWidth(106), KHeight(45));
            [_guideScrollView addSubview:button];
            
        }
        if (i == 7||i == 4||i == 5||i == 6)
        {

            UIImageView *guidePageView = [[UIImageView alloc]initWithFrame:CGRectMake(_guideScrollView.frame.size.width * (i - 1),KHeight(71) , KWidth(375), KHeight(375))];
            guidePageView.image = [UIImage imageNamed:self.guideImageArray[i - 1]];
            [_guideScrollView addSubview:guidePageView];
            
            
            UILabel *contentLab = [[UILabel alloc]init];
            contentLab.text = @"您每年是否定期体检？";
            contentLab.textColor = [UIColor getColor:@"2C4667"];
            contentLab.font = Kfont(17);
            contentLab.textAlignment = NSTextAlignmentCenter;
            contentLab.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1),KHeight(71)+KHeight(375)+KHeight(20), KScreenWidth, KHeight(20));
            [_guideScrollView addSubview:contentLab];
            
            
            
            UIButton *yesbutton = [UIButton buttonWithType:UIButtonTypeCustom];
            [yesbutton setBackgroundColor:kMainColor];
            yesbutton.titleLabel.font = [UIFont systemFontOfSize:13.0];
            [yesbutton setTitle:@"是" forState:UIControlStateNormal];
            [yesbutton addTarget:self action:@selector(yesbuttonSelect:) forControlEvents:UIControlEventTouchUpInside];
        
            yesbutton.layer.cornerRadius = KHeight(45)/2.0;
            yesbutton.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+ KWidth(49), KScreenHeight - KHeight(103), KWidth(106), KHeight(45));
            [_guideScrollView addSubview:yesbutton];
            
            
            UIButton *NObutton = [UIButton buttonWithType:UIButtonTypeCustom];
            [NObutton setBackgroundColor:kMainColor];
            NObutton.titleLabel.font = [UIFont systemFontOfSize:13.0];
            [NObutton setTitle:@"否" forState:UIControlStateNormal];
            [NObutton addTarget:self action:@selector(yesbuttonSelect:) forControlEvents:UIControlEventTouchUpInside];
            NObutton.layer.cornerRadius = KHeight(45)/2.0;
            
            NObutton.frame = CGRectMake(_guideScrollView.frame.size.width * (i - 1)+KScreenWidth  - KWidth(106)-KWidth(49), KScreenHeight - KHeight(103), KWidth(106), KHeight(45));
            [_guideScrollView addSubview:NObutton];
            
        }
        
        
//
    }
    
}

-(void)NObutton:(UIButton *)sender
{
    
    
    
}
-(void)selectBtn:(UIButton *)sender
{
    
   NSInteger tag =   sender.tag - 1234;
    sender.selected = !sender.selected;
//    for (UIButton  *btn in self.btnArray) {
//        btn.selected =
//    }
    
}

-(void)hiddenGuidePage:(UIButton *)sender
{
    NSString *nowVersion = [[[NSBundle mainBundle] infoDictionary] objectForKey:@"CFBundleShortVersionString"];
    [[NSUserDefaults standardUserDefaults] setObject:nowVersion forKey:@"lastVersion"];
    [[NSUserDefaults standardUserDefaults] synchronize];
    
    WEAKSELF
    [UIView animateWithDuration:1.5 animations:^{
        if(weakSelf.hideGuideViewBlock)
        {
            weakSelf.hideGuideViewBlock();
        }
        weakSelf.guideScrollView.alpha = 0;
        [[UIApplication sharedApplication] setStatusBarHidden:NO];
    }completion:^( BOOL finish){
        
        [self removeFromSuperview];
    }];
}


#pragma mark scrollView delegate
- (void)scrollViewDidScroll:(UIScrollView *)scrollView
{
    if(scrollView.contentOffset.x <= 0){
        [scrollView setContentOffset:CGPointMake(0, 0) animated:NO];
    }
    
    CGFloat pageWidth = scrollView.frame.size.width;
    int currentPage = floor((scrollView.contentOffset.x - pageWidth / 2) / pageWidth) + 1;

    if (currentPage == self.guideImageArray.count )
    {
        [self hiddenGuidePage:nil];
    }
    NSLog(@"%d",currentPage);
}
#pragma mark yesbuttonSelect
-(void)yesbuttonSelect:(UIButton *)btn
{
    
    
    
}
#pragma lazy load
- (void)setGuideImageArray:(NSArray *)guideImageArray
{
    if (!_guideImageArray) {
        _guideImageArray = @[@"iv_question_robot",@"",@"",@"iv_question_examination",@"iv_question_breakfast",@"iv_question_sports",@"iv_question_drink",@""];
    }
}
-(void)setPlanArray:(NSMutableArray *)planArray
{
    
    if (!_planArray) {
        _planArray = @[@"健康饮食计划",@"每日饮水计划",@"运动计划",@"喝水提醒"];
    }
}
@end
